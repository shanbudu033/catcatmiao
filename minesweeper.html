<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‰«é›·å°æ¸¸æˆ</title>
    <style>
        /* ç»§æ‰¿ä¸»é¡µé¢çš„å¯çˆ±é£æ ¼ */
        body {
            font-family: 'Comic Sans MS', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background-color: #fdf3f8; /* æŸ”å’Œçš„ç²‰è‰²èƒŒæ™¯ */
            background-image: url('https://www.transparenttextures.com/patterns/light-honeycomb.png');
            color: #555;
            padding: 20px;
            box-sizing: border-box;
            position: relative; /* ç”¨äºå®šä½å¸®åŠ©æŒ‰é’® */
        }
        h1 {
            color: #ff69b4; /* å¯çˆ±çš„çƒ­ç²‰è‰²æ ‡é¢˜ */
            margin-bottom: 20px;
            font-size: 2.5em;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
        }
        /* è¿”å›æ¸¸æˆä¸­å¿ƒæŒ‰é’®çš„æ ·å¼ */
        .back-button {
            padding: 12px 25px;
            font-size: 1.1em;
            cursor: pointer;
            background-color: #98fb98; /* æµ…ç»¿è‰²æŒ‰é’® */
            color: #333;
            border: none;
            border-radius: 15px;
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
            box-shadow: 0 6px 15px rgba(152, 251, 152, 0.3);
            margin-top: 30px; /* ä¸æ¸¸æˆåŒºåŸŸä¿æŒè·ç¦» */
        }
        .back-button:hover {
            background-color: #66cd66;
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(102, 205, 102, 0.4);
        }
        .back-button:active {
            transform: translateY(0);
            box-shadow: 0 4px 10px rgba(102, 205, 102, 0.3);
        }

        /* æ‰«é›·æ¸¸æˆå®¹å™¨æ ·å¼ */
        #minesweeper-container {
            background-color: #ffffff;
            border-radius: 25px;
            box-shadow: 0 15px 30px rgba(255, 192, 203, 0.3);
            padding: 30px;
            text-align: center;
            max-width: 500px; /* é€‚åº”æ¸¸æˆæ¿å¤§å° */
            width: 90%;
            margin-bottom: 20px;
            border: 2px solid #ffe4e1;
            position: relative; /* ç”¨äºå®šä½å¸®åŠ©æŒ‰é’® */
        }

        /* æ¸¸æˆä¿¡æ¯ï¼ˆåœ°é›·æ•°ã€è®¡æ—¶å™¨ï¼‰æ ·å¼ */
        #game-info {
            display: flex;
            justify-content: space-around;
            margin-bottom: 15px;
            font-weight: bold;
            color: #ff69b4; /* å¯çˆ±çš„ç²‰è‰² */
            font-size: 1.2em;
            background-color: #fff0f5;
            padding: 10px 15px;
            border-radius: 12px;
            border: 1px solid #ffebf0;
        }

        /* æ¸¸æˆæ¿ç½‘æ ¼æ ·å¼ */
        #board {
            display: grid;
            /* grid-template-columns ä¼šç”± JavaScript è®¾ç½® */
            border: 2px solid #ccc;
            margin: 0 auto;
            background-color: #eee;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.1); /* å†…éƒ¨é˜´å½± */
            border-radius: 5px;
        }

        /* å•å…ƒæ ¼åŸºç¡€æ ·å¼ */
        .cell {
            width: 30px; /* å›ºå®šå•å…ƒæ ¼å¤§å° */
            height: 30px;
            background-color: #b0e0e6; /* æœªæ­ç¤ºçš„æµ…è“è‰² */
            border: 3px outset #a0d0d6; /* 3D å‡¸èµ·æ•ˆæœ */
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            font-size: 1.2em;
            cursor: pointer;
            user-select: none; /* é˜²æ­¢æ–‡æœ¬è¢«é€‰ä¸­ */
            transition: background-color 0.1s ease; /* é¼ æ ‡æ‚¬åœå¹³æ»‘è¿‡æ¸¡ */
            color: transparent; /* é»˜è®¤éšè—æ•°å­—/åœ°é›·å›¾æ ‡ */
        }
        .cell:hover:not(.revealed):not(.flagged) {
            background-color: #90c0c6; /* é¼ æ ‡æ‚¬åœæ—¶é¢œè‰²ç¨æ·± */
        }

        /* æ­ç¤ºåçš„å•å…ƒæ ¼æ ·å¼ */
        .cell.revealed {
            background-color: #e0ffff; /* æ­ç¤ºåçš„æ›´æµ…è“è‰² */
            border: 1px solid #ccc; /* æ‰å¹³æ•ˆæœ */
            cursor: default;
            color: #333; /* æ­ç¤ºåæ˜¾ç¤ºå†…å®¹ */
        }

        /* åœ°é›·å•å…ƒæ ¼æ ·å¼ */
        .cell.mine {
            background-color: #ff6347; /* çº¢è‰² */
            color: white;
            border: 1px solid #ff6347; /* æ‰å¹³ */
        }

        /* æ ‡è®°ä¸ºåœ°é›·çš„å•å…ƒæ ¼æ ·å¼ */
        .cell.flagged {
            background-color: #ffd700; /* é‡‘è‰² */
            color: #333;
            border: 3px outset #e0c000; /* ä¿æŒ 3D å‡¸èµ· */
            font-size: 1.5em; /* æ——å¸œå›¾æ ‡æ›´å¤§ */
        }
        /* æ¸¸æˆç»“æŸæ—¶ï¼Œå¦‚æœæ ‡è®°é”™è¯¯ï¼Œæ˜¾ç¤ºX */
        .cell.flagged.wrong-mine {
            background-color: #ff4500; /* æ©™çº¢è‰² */
            color: white;
        }

        /* æ•°å­—é¢œè‰² */
        .cell.num1 { color: #0000ff; } /* è“è‰² */
        .cell.num2 { color: #008000; } /* ç»¿è‰² */
        .cell.num3 { color: #ff0000; } /* çº¢è‰² */
        .cell.num4 { color: #000080; } /* æ·±è“è‰² */
        .cell.num5 { color: #800000; } /* æ —è‰² */
        .cell.num6 { color: #008080; } /* é’è‰² */
        .cell.num7 { color: #000000; } /* é»‘è‰² */
        .cell.num8 { color: #808080; } /* ç°è‰² */

        /* æ¸¸æˆæ¶ˆæ¯æ ·å¼ */
        #message {
            margin-top: 20px;
            font-size: 1.3em;
            font-weight: bold;
            color: #ff69b4;
            min-height: 1.5em; /* ç¡®ä¿æ¶ˆæ¯åŒºåŸŸé«˜åº¦ç¨³å®š */
        }
        .message-win { color: #008000; } /* èƒœåˆ©æ¶ˆæ¯ç»¿è‰² */
        .message-lose { color: #ff0000; } /* å¤±è´¥æ¶ˆæ¯çº¢è‰² */

        /* é‡æ–°å¼€å§‹æŒ‰é’®æ ·å¼ */
        #resetButton {
            margin-top: 20px;
            padding: 12px 25px;
            font-size: 1.1em;
            cursor: pointer;
            background-color: #87ceeb; /* å¤©è“è‰² */
            color: white;
            border: none;
            border-radius: 15px;
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
            box-shadow: 0 6px 15px rgba(135, 206, 235, 0.3);
        }
        #resetButton:hover {
            background-color: #6a5acd;
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(106, 90, 205, 0.4);
        }
        #resetButton:active {
            transform: translateY(0);
            box-shadow: 0 4px 10px rgba(106, 90, 205, 0.3);
        }

        /* å¸®åŠ©æŒ‰é’®æ ·å¼ */
        #helpButton {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #ffebcd; /* æä»è‰² */
            color: #d2691e; /* å·§å…‹åŠ›è‰² */
            border: 2px solid #deb887; /* æ²™æ£•è‰² */
            font-size: 1.8em;
            font-weight: bold;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            transition: background-color 0.2s, transform 0.2s;
            z-index: 10; /* ç¡®ä¿åœ¨å…¶ä»–å…ƒç´ ä¹‹ä¸Š */
        }
        #helpButton:hover {
            background-color: #ffe4b5;
            transform: scale(1.05);
        }

        /* å¸®åŠ©å¡ç‰‡ï¼ˆæ¨¡æ€æ¡†ï¼‰æ ·å¼ */
        #helpModal {
            display: none; /* é»˜è®¤éšè— */
            position: fixed;
            z-index: 100; /* ç¡®ä¿åœ¨æœ€ä¸Šå±‚ */
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.5); /* åŠé€æ˜é»‘è‰²èƒŒæ™¯ */
            backdrop-filter: blur(5px); /* æ¨¡ç³ŠèƒŒæ™¯ */
            -webkit-backdrop-filter: blur(5px); /* Safari å…¼å®¹ */
            padding-top: 60px;
        }

        .help-modal-content {
            background-color: #fefefe;
            margin: 5% auto; /* å±…ä¸­æ˜¾ç¤º */
            padding: 30px;
            border: 1px solid #888;
            width: 80%;
            max-width: 600px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(255, 192, 203, 0.5);
            position: relative;
            animation: fadeIn 0.3s ease-out; /* å¼¹å‡ºåŠ¨ç”» */
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .help-modal-content h2 {
            color: #ff69b4;
            margin-top: 0;
            font-size: 2em;
            margin-bottom: 20px;
        }

        .help-modal-content p {
            font-size: 1.1em;
            line-height: 1.6;
            margin-bottom: 15px;
            text-align: left;
        }

        .help-modal-content ul {
            text-align: left;
            margin-bottom: 20px;
            padding-left: 25px;
        }
        .help-modal-content ul li {
            margin-bottom: 8px;
            font-size: 1.05em;
            color: #666;
        }

        .close-button {
            color: #aaa;
            position: absolute;
            top: 15px;
            right: 25px;
            font-size: 35px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.2s;
        }
        .close-button:hover,
        .close-button:focus {
            color: #ff69b4;
            text-decoration: none;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>æ‰«é›·å°æ¸¸æˆ</h1>
    <div id="minesweeper-container">
        <!-- å¸®åŠ©æŒ‰é’® -->
        <button id="helpButton">?</button>

        <div id="game-info">
            <span id="mine-count">åœ°é›·: 0</span>
            <span id="timer">æ—¶é—´: 0</span>
        </div>
        <div id="board"></div>
        <p id="message"></p>
        <button id="resetButton">é‡æ–°å¼€å§‹</button>
    </div>
    <button onclick="window.location.href='game.html'" class="back-button">è¿”å›æ¸¸æˆä¸­å¿ƒ</button>

    <!-- å¸®åŠ©æ¨¡æ€æ¡† -->
    <div id="helpModal" class="modal">
        <div class="help-modal-content">
            <span class="close-button">&times;</span>
            <h2>æ‰«é›·ç©æ³•è¯´æ˜</h2>
            <p>æ‰«é›·æ˜¯ä¸€ä¸ªç»å…¸çš„é€»è¾‘ç›Šæ™ºæ¸¸æˆï¼Œç›®æ ‡æ˜¯æ­ç¤ºæ‰€æœ‰æ²¡æœ‰åœ°é›·çš„æ–¹å—ï¼ŒåŒæ—¶é¿å…è§¦ç¢°åˆ°ä»»ä½•åœ°é›·ã€‚</p>
            <ul>
                <li><strong>å·¦é”®ç‚¹å‡»ï¼š</strong> æ­ç¤ºä¸€ä¸ªæ–¹å—ã€‚</li>
                <li><strong>å³é”®ç‚¹å‡»ï¼ˆæˆ–é•¿æŒ‰ï¼‰ï¼š</strong> åœ¨ä½ è®¤ä¸ºæœ‰åœ°é›·çš„æ–¹å—ä¸Šæ’æ—— ğŸš©ã€‚å†æ¬¡å³é”®ç‚¹å‡»å¯ä»¥å–æ¶ˆæ’æ——ã€‚</li>
                <li><strong>æ•°å­—æ–¹å—ï¼š</strong> æ­ç¤ºåï¼Œå¦‚æœæ–¹å—ä¸Šæ˜¾ç¤ºæ•°å­—ï¼ˆ1-8ï¼‰ï¼Œè¡¨ç¤ºå®ƒå‘¨å›´çš„8ä¸ªç›¸é‚»æ–¹å—ä¸­æœ‰å¯¹åº”æ•°é‡çš„åœ°é›·ã€‚</li>
                <li><strong>ç©ºç™½æ–¹å—ï¼š</strong> å¦‚æœæ­ç¤ºçš„æ–¹å—æ˜¯ç©ºç™½ï¼ˆæ²¡æœ‰æ•°å­—ï¼‰ï¼Œè¡¨ç¤ºå®ƒå‘¨å›´æ²¡æœ‰åœ°é›·ï¼Œæ¸¸æˆä¼šè‡ªåŠ¨å¸®ä½ æ­ç¤ºæ‰€æœ‰ç›¸é‚»çš„ç©ºç™½æ–¹å—ï¼Œç›´åˆ°é‡åˆ°æ•°å­—æ–¹å—ã€‚</li>
                <li><strong>åœ°é›·æ–¹å—ï¼š</strong> å¦‚æœä½ å·¦é”®ç‚¹å‡»åˆ°åœ°é›· ğŸ’£ï¼Œæ¸¸æˆå°±ç»“æŸäº†ï¼Œä½ è¾“äº†ï¼</li>
                <li><strong>èƒœåˆ©æ¡ä»¶ï¼š</strong> æˆåŠŸæ­ç¤ºæ‰€æœ‰éåœ°é›·çš„æ–¹å—ã€‚</li>
            </ul>
            <p>ç¥ä½ å¥½è¿ï¼Œå°å¿ƒåœ°é›·ï¼</p>
        </div>
    </div>

    <script>
        // --- æ¸¸æˆé…ç½® ---
        const BOARD_ROWS = 10;
        const BOARD_COLS = 10;
        const NUM_MINES = 15;
        const WIN_GOLD_REWARD = 20; // é€šå…³å¥–åŠ±é‡‘å¸æ•°é‡

        // --- DOM å…ƒç´  ---
        const boardElement = document.getElementById('board');
        const mineCountElement = document.getElementById('mine-count');
        const timerElement = document.getElementById('timer');
        const messageElement = document.getElementById('message');
        const resetButton = document.getElementById('resetButton');
        const helpButton = document.getElementById('helpButton'); // å¸®åŠ©æŒ‰é’®
        const helpModal = document.getElementById('helpModal');     // å¸®åŠ©æ¨¡æ€æ¡†
        const closeButton = document.querySelector('.close-button'); // å…³é—­æŒ‰é’®

        // --- æ¸¸æˆçŠ¶æ€å˜é‡ ---
        let board = []; // å­˜å‚¨æ¯ä¸ªå•å…ƒæ ¼çš„æ•°æ® (mine, number, revealed, flagged)
        let gameOver = false;
        let minesPlaced = 0; // å®é™…æ”¾ç½®çš„åœ°é›·æ•°é‡
        let revealedCells = 0; // å·²æ­ç¤ºçš„éåœ°é›·å•å…ƒæ ¼æ•°é‡
        let flagsPlaced = 0; // å·²æ”¾ç½®çš„æ——å¸œæ•°é‡
        let seconds = 0;
        let timerInterval = null;
        let gameStarted = false; // æ ‡è®°æ¸¸æˆæ˜¯å¦å·²å¼€å§‹ï¼ˆç”¨äºé¦–æ¬¡ç‚¹å‡»å¯åŠ¨è®¡æ—¶å™¨ï¼‰

        // --- è¾…åŠ©å‡½æ•°ï¼šè·å–ç›¸é‚»å•å…ƒæ ¼åæ ‡ ---
        const directions = [
            [-1, -1], [-1, 0], [-1, 1],
            [0, -1],           [0, 1],
            [1, -1], [1, 0], [1, 1]
        ];

        // --- æ¸¸æˆåˆå§‹åŒ– ---
        function initGame() {
            // é‡ç½®æ¸¸æˆçŠ¶æ€
            board = [];
            gameOver = false;
            minesPlaced = 0;
            revealedCells = 0;
            flagsPlaced = 0;
            seconds = 0;
            gameStarted = false; // é‡ç½®æ¸¸æˆå¼€å§‹æ ‡è®°
            messageElement.textContent = '';
            messageElement.className = ''; // æ¸…é™¤æ¶ˆæ¯æ ·å¼

            // æ¸…é™¤è®¡æ—¶å™¨
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
            timerElement.textContent = 'æ—¶é—´: 0';

            // è®¾ç½® CSS Grid å¸ƒå±€
            boardElement.style.gridTemplateColumns = `repeat(${BOARD_COLS}, 30px)`;
            boardElement.innerHTML = ''; // æ¸…ç©ºæ—§çš„æ£‹ç›˜

            // åˆ›å»ºæ£‹ç›˜æ•°æ®ç»“æ„å’Œ DOM å…ƒç´ 
            for (let r = 0; r < BOARD_ROWS; r++) {
                board[r] = [];
                for (let c = 0; c < BOARD_COLS; c++) {
                    const cellData = {
                        row: r,
                        col: c,
                        isMine: false,
                        mineCount: 0, // å‘¨å›´åœ°é›·æ•°
                        isRevealed: false,
                        isFlagged: false,
                        element: null // å­˜å‚¨å¯¹åº”çš„ DOM å…ƒç´ 
                    };
                    board[r][c] = cellData;

                    const cellElement = document.createElement('div');
                    cellElement.classList.add('cell');
                    cellElement.dataset.row = r;
                    cellElement.dataset.col = c;
                    cellElement.addEventListener('click', () => handleClick(r, c));
                    cellElement.addEventListener('contextmenu', (e) => handleRightClick(e, r, c)); // å³é”®ç‚¹å‡»
                    cellData.element = cellElement;
                    boardElement.appendChild(cellElement);
                }
            }

            placeMines();
            calculateNumbers();
            updateMineCountDisplay();
        }

        // --- æ”¾ç½®åœ°é›· ---
        function placeMines() {
            let minesToPlace = NUM_MINES;
            while (minesToPlace > 0) {
                const r = Math.floor(Math.random() * BOARD_ROWS);
                const c = Math.floor(Math.random() * BOARD_COLS);

                if (!board[r][c].isMine) {
                    board[r][c].isMine = true;
                    minesToPlace--;
                    minesPlaced++; // è®°å½•å®é™…æ”¾ç½®çš„åœ°é›·æ•°
                }
            }
        }

        // --- è®¡ç®—æ¯ä¸ªå•å…ƒæ ¼å‘¨å›´çš„åœ°é›·æ•° ---
        function calculateNumbers() {
            for (let r = 0; r < BOARD_ROWS; r++) {
                for (let c = 0; c < BOARD_COLS; c++) {
                    if (!board[r][c].isMine) {
                        let count = 0;
                        directions.forEach(([dr, dc]) => {
                            const nr = r + dr;
                            const nc = c + dc;
                            if (nr >= 0 && nr < BOARD_ROWS && nc >= 0 && nc < BOARD_COLS && board[nr][nc].isMine) {
                                count++;
                            }
                        });
                        board[r][c].mineCount = count;
                    }
                }
            }
        }

        // --- å·¦é”®ç‚¹å‡»å¤„ç† ---
        function handleClick(r, c) {
            if (gameOver || board[r][c].isRevealed || board[r][c].isFlagged) {
                return;
            }

            // é¦–æ¬¡ç‚¹å‡»æ—¶å¯åŠ¨è®¡æ—¶å™¨
            if (!gameStarted) {
                gameStarted = true;
                timerInterval = setInterval(updateTimer, 1000);
            }

            const cell = board[r][c];
            cell.isRevealed = true;
            cell.element.classList.add('revealed');

            if (cell.isMine) {
                cell.element.textContent = 'ğŸ’£';
                cell.element.classList.add('mine');
                gameOverState(false); // æ¸¸æˆå¤±è´¥
            } else {
                revealedCells++;
                if (cell.mineCount > 0) {
                    cell.element.textContent = cell.mineCount;
                    cell.element.classList.add(`num${cell.mineCount}`);
                } else {
                    // å¦‚æœæ˜¯ç©ºç™½æ ¼å­ï¼Œè‡ªåŠ¨æ­ç¤ºå‘¨å›´çš„æ ¼å­
                    revealEmptyCells(r, c);
                }
                checkWin();
            }
        }

        // --- å³é”®ç‚¹å‡»å¤„ç† (æ’æ——) ---
        function handleRightClick(event, r, c) {
            event.preventDefault(); // é˜»æ­¢æµè§ˆå™¨é»˜è®¤çš„å³é”®èœå•

            if (gameOver || board[r][c].isRevealed) {
                return;
            }

            // é¦–æ¬¡ç‚¹å‡»æ—¶å¯åŠ¨è®¡æ—¶å™¨
            if (!gameStarted) {
                gameStarted = true;
                timerInterval = setInterval(updateTimer, 1000);
            }

            const cell = board[r][c];
            if (cell.isFlagged) {
                cell.isFlagged = false;
                cell.element.classList.remove('flagged');
                cell.element.textContent = '';
                flagsPlaced--;
            } else {
                if (flagsPlaced >= minesPlaced) { // æ——å¸œæ•°é‡ä¸èƒ½è¶…è¿‡åœ°é›·æ€»æ•°
                    messageElement.textContent = 'æ——å¸œæ•°é‡å·²è¾¾ä¸Šé™ï¼';
                    messageElement.classList.add('warning');
                    setTimeout(() => {
                        messageElement.textContent = '';
                        messageElement.classList.remove('warning');
                    }, 2000);
                    return;
                }
                cell.isFlagged = true;
                cell.element.classList.add('flagged');
                cell.element.textContent = 'ğŸš©';
                flagsPlaced++;
            }
            updateMineCountDisplay();
        }

        // --- æ­ç¤ºç©ºç™½å•å…ƒæ ¼ (é€’å½’/æ´ªæ°´å¡«å……) ---
        function revealEmptyCells(r, c) {
            // ä½¿ç”¨é˜Ÿåˆ—å®ç°å¹¿åº¦ä¼˜å…ˆæœç´¢ï¼Œé¿å…é€’å½’æ·±åº¦è¿‡å¤§
            const queue = [{ r, c }];
            const visited = new Set(); // è®°å½•å·²è®¿é—®çš„å•å…ƒæ ¼ï¼Œé¿å…é‡å¤å¤„ç†

            while (queue.length > 0) {
                const { r: currR, c: currC } = queue.shift();
                const cellKey = `${currR},${currC}`;

                if (visited.has(cellKey)) continue;
                visited.add(cellKey);

                const cell = board[currR][currC];

                if (cell.isRevealed || cell.isMine || cell.isFlagged) {
                    continue;
                }

                cell.isRevealed = true;
                cell.element.classList.add('revealed');
                revealedCells++;

                if (cell.mineCount > 0) {
                    cell.element.textContent = cell.mineCount;
                    cell.element.classList.add(`num${cell.mineCount}`);
                } else {
                    // å¦‚æœæ˜¯ç©ºç™½ï¼Œåˆ™å°†æ‰€æœ‰ç›¸é‚»çš„æœªæ­ç¤ºå•å…ƒæ ¼åŠ å…¥é˜Ÿåˆ—
                    directions.forEach(([dr, dc]) => {
                        const nr = currR + dr;
                        const nc = currC + dc;
                        if (nr >= 0 && nr < BOARD_ROWS && nc >= 0 && nc < BOARD_COLS) {
                            const neighbor = board[nr][nc];
                            if (!neighbor.isRevealed && !neighbor.isFlagged) {
                                queue.push({ r: nr, c: nc });
                            }
                        }
                    });
                }
            }
        }


        // --- æ£€æŸ¥èƒœåˆ©æ¡ä»¶ ---
        function checkWin() {
            // èƒœåˆ©æ¡ä»¶ï¼šæ‰€æœ‰éåœ°é›·å•å…ƒæ ¼éƒ½è¢«æ­ç¤º
            if (revealedCells === (BOARD_ROWS * BOARD_COLS) - minesPlaced) {
                gameOverState(true);
            }
        }

        // --- æ¸¸æˆç»“æŸå¤„ç† ---
        function gameOverState(isWin) {
            gameOver = true;
            clearInterval(timerInterval); // åœæ­¢è®¡æ—¶å™¨
            timerInterval = null;

            // æ­ç¤ºæ‰€æœ‰åœ°é›·
            for (let r = 0; r < BOARD_ROWS; r++) {
                for (let c = 0; c < BOARD_COLS; c++) {
                    const cell = board[r][c];
                    if (cell.isMine && !cell.isFlagged) {
                        cell.element.textContent = 'ğŸ’£';
                        cell.element.classList.add('mine', 'revealed');
                    } else if (!cell.isMine && cell.isFlagged) {
                        // æ ‡è®°é”™è¯¯çš„åœ°é›·
                        cell.element.textContent = 'âŒ';
                        cell.element.classList.add('wrong-mine', 'revealed');
                    }
                }
            }

            if (isWin) {
                messageElement.textContent = `æ­å–œä½ ï¼Œä½ èµ¢äº†ï¼ç”¨æ—¶ ${seconds} ç§’ï¼è·å¾—äº† ${WIN_GOLD_REWARD} é‡‘å¸ï¼`;
                messageElement.classList.add('message-win');
                addGoldToMainGame(WIN_GOLD_REWARD); // å¥–åŠ±é‡‘å¸
            } else {
                messageElement.textContent = `å¾ˆé—æ†¾ï¼Œä½ è¸©åˆ°é›·äº†ï¼æ¸¸æˆç»“æŸï¼`;
                messageElement.classList.add('message-lose');
            }
        }

        // --- æ›´æ–°è®¡æ—¶å™¨æ˜¾ç¤º ---
        function updateTimer() {
            seconds++;
            timerElement.textContent = `æ—¶é—´: ${seconds}`;
        }

        // --- æ›´æ–°åœ°é›·è®¡æ•°å™¨æ˜¾ç¤º ---
        function updateMineCountDisplay() {
            mineCountElement.textContent = `åœ°é›·: ${minesPlaced - flagsPlaced}`;
        }

        // --- ä¸ä¸»æ¸¸æˆäº¤äº’ï¼šå¢åŠ é‡‘å¸ ---
        function addGoldToMainGame(amount) {
            // ä» localStorage è·å–ä¸»æ¸¸æˆçŠ¶æ€
            const savedState = localStorage.getItem('catGameSaveState');
            if (savedState) {
                try {
                    let cat = JSON.parse(savedState);
                    if (typeof cat.gold === 'undefined') {
                        cat.gold = 0; // å¦‚æœæ²¡æœ‰ gold å±æ€§ï¼Œåˆå§‹åŒ–ä¸º 0
                    }
                    cat.gold += amount;
                    localStorage.setItem('catGameSaveState', JSON.stringify(cat));
                    console.log(`æˆåŠŸä¸ºä¸»æ¸¸æˆå¢åŠ äº† ${amount} é‡‘å¸ã€‚å½“å‰é‡‘å¸: ${cat.gold}`);
                } catch (e) {
                    console.error('è§£æä¸»æ¸¸æˆå­˜æ¡£å¤±è´¥ï¼Œæ— æ³•å¢åŠ é‡‘å¸:', e);
                }
            } else {
                console.warn('æœªæ‰¾åˆ°ä¸»æ¸¸æˆå­˜æ¡£ï¼Œæ— æ³•å¢åŠ é‡‘å¸ã€‚');
            }
        }

        // --- äº‹ä»¶ç›‘å¬å™¨ ---
        resetButton.addEventListener('click', initGame);

        // å¸®åŠ©æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        helpButton.addEventListener('click', () => {
            helpModal.style.display = 'block';
        });

        // å…³é—­æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        closeButton.addEventListener('click', () => {
            helpModal.style.display = 'none';
        });

        // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
        window.addEventListener('click', (event) => {
            if (event.target === helpModal) {
                helpModal.style.display = 'none';
            }
        });

        // --- é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–æ¸¸æˆ ---
        window.addEventListener('DOMContentLoaded', initGame);
    </script>
</body>
</html>
